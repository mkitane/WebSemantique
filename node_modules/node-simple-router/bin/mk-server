#!/usr/bin/env node

// Generated by CoffeeScript 1.8.0
(function() {
  var arr, cs, filename, fs, full_filename, js, text, _ref, _ref1;

  arr = [];

  arr.push("#!/usr/bin/env coffee");

  arr.push("\n");

  arr.push("try");

  arr.push("  Router = require 'node-simple-router'");

  arr.push("catch e");

  arr.push("  console.log 'node-simple-router must be installed for this to work'");

  arr.push("  process.exit(-1)\n");

  arr.push("http = require 'http'");

  arr.push("router = Router(list_dir: true)");

  arr.push("#");

  arr.push("#Example routes");

  arr.push("#");

  arr.push("router.get \"/\", (request, response) ->");

  arr.push("  response.writeHead(200, {'Content-Type': 'text/html'})");

  arr.push('  response.write("<h1>Home</h1><hr/>")');

  arr.push('  response.write(\'<div><a href="/hello">Hello Page</a></div>\')');

  arr.push('  response.write(\'<div><a href="/users">Users Page</a></div>\')');

  arr.push('  response.end(\'<div><a href="/users/77">User 77 home page</a></div>\')\n');

  arr.push("router.get \"/hello\", (request, response) ->");

  arr.push(" response.end 'Hello, World!, Hola, Mundo!'\n");

  arr.push("router.get \"/users\", (request, response) ->");

  arr.push("  response.writeHead(200, {'Content-type': 'text/html'})");

  arr.push("  response.write '<h1 style=\"color: navy; text-align: center;\">Active members registry</h1><hr/>'\n");

  arr.push('  response.write(\'<div><form action="/users" method="POST">\')');

  arr.push('  response.write(\'<label>User ID: </label>\')');

  arr.push('  response.write(\'<input type="number" name="user_id" /><input type="submit" value="Search" />\')');

  arr.push('  response.end(\'</form></div>\')');

  arr.push("router.post \"/users\", (request, response) ->");

  arr.push('  response.end "User #{request.post.user_id} requested. Trying to figure out who she is..." \n');

  arr.push("router.any \"/users/:id\", (request, response) ->");

  arr.push("  response.writeHead(200, {'Content-type': 'text/html'})");

  arr.push("  response.end \"<h1>User No: <span style='color: red;'>\" + request.params.id + \"</span></h1>\"\n");

  arr.push("#");

  arr.push("#End of example routes");

  arr.push("#\n\n");

  arr.push("#Ok, just start the server!\n");

  arr.push("argv = process.argv.slice 2\n");

  arr.push("server = http.createServer router\n");

  arr.push("server.on 'listening', ->");

  arr.push("  addr = server.address() or {address: '0.0.0.0', port: argv[0] or 8000}");

  arr.push("  router.log \"Serving web content at \" + addr.address + \":\" + addr.port  + \" - PID: \" + process.pid \n");

  arr.push("clean_up = ->");

  arr.push("  router.log ' '");

  arr.push("  router.log \"Server shutting up...\"");

  arr.push("  router.log ' '");

  arr.push("  server.close()");

  arr.push("  process.exit 0\n");

  arr.push("process.on 'SIGINT', clean_up");

  arr.push("process.on 'SIGHUP', clean_up");

  arr.push("process.on 'SIGQUIT', clean_up");

  arr.push("process.on 'SIGTERM', clean_up\n");

  arr.push("server.listen if argv[0]? and not isNaN(parseInt(argv[0])) then parseInt(argv[0]) else 8000");

  cs = arr.join('\n');

  js = "#!/usr/bin/env node\n\n(function() {\nvar Router, argv, http, router, server, clean_up;\n\ntry {\nRouter = require('node-simple-router');\n} catch (e) {\nconsole.log('node-simple-router must be installed for this to work');\nprocess.exit(-1);\n}\n\nhttp = require('http');\n\nrouter = Router({\nlist_dir: true\n});\n\n/*\nExample routes\n*/\n\nrouter.get(\"/\", function(request, response) {\n    response.writeHead(200, {\n      'Content-type': 'text/html'\n    });\n    response.write(\"<h1>Home</h1><hr/>\");\n    response.write('<div><a href=\"/hello\">Hello Page</a></div>');\n    response.write('<div><a href=\"/users\">Users Page</a></div>');\n    return response.end('<div><a href=\"/users/77\">User 77 home page</a></div>');\n});\n\nrouter.get(\"/hello\", function(request, response) {\n  return response.end(\"Hello, World!, Hola, Mundo!\");\n});\n\nrouter.get(\"/users\", function(request, response) {\n  response.writeHead(200, {\n  'Content-type': 'text/html'\n  });\n  response.write(\"<h1 style='color: navy; text-align: center;'>Active members registry</h1><hr/>\");\n  response.write('<div><form action=\"/users\" method=\"POST\">');\n  response.write('<label>User ID: </label>');\n  response.write('<input type=\"number\" name=\"user_id\" /><input type=\"submit\" value=\"Search\" />');\n  return response.end('</form></div>');\n});\n\nrouter.post(\"/users\", function(request, response) {\n  return response.end(\"User \" + request.post.user_id + \" requested. Trying to figure out who she is...\");\n});\n\nrouter.any(\"/users/:id\", function(request, response) {\n  response.writeHead(200, {\n    'Content-type': 'text/html'\n  });\n  return response.end(\"<h1>User No: <span style='color: red;'>\" + request.params.id + \"</span></h1>\");\n});\n\n/*\nEnd of example routes\n*/\n\n\nargv = process.argv.slice(2);\n\nserver = http.createServer(router);\n\nserver.on('listening', function() {\n  var addr;\n  addr = server.address() || {\n    address: '0.0.0.0',\n    port: argv[0] || 8000\n  };\n  return router.log(\"Serving web content at \" + addr.address + \":\" + addr.port + \" - PID: \" + process.pid);\n});\n\nclean_up = function() {\n  router.log(\" \");\n  router.log(\"Server shutting up...\");\n  router.log(\" \");\n  server.close();\n  return process.exit(0);\n};\n\nprocess.on('SIGINT', clean_up);\nprocess.on('SIGHUP', clean_up);\nprocess.on('SIGQUIT', clean_up);\nprocess.on('SIGTERM', clean_up);\n\nserver.listen((argv[0] != null) && !isNaN(parseInt(argv[0])) ? parseInt(argv[0]) : 8000);\n\n}).call(this);\n";

  fs = require('fs');

  filename = ((_ref = process.argv[2]) != null ? _ref.toLowerCase() : void 0) === 'js' ? 'server.js' : 'server.coffee';

  full_filename = "" + (process.cwd()) + "/" + filename;

  text = ((_ref1 = process.argv[2]) != null ? _ref1.toLowerCase() : void 0) === 'js' ? js : cs;

  fs.writeFileSync(full_filename, text);

  fs.chmodSync(full_filename, 0x1ed);

}).call(this);
